// Generated by CoffeeScript 1.9.1
(function() {
  var $, FieldGuide, TabSet,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  $ = window.jQuery;

  TabSet = require('./tab-control');

  FieldGuide = (function() {
    FieldGuide.prototype.examples = null;

    FieldGuide.prototype.template = function(examples) {
      var figure, i, page;
      return "<div class='readymade-field-guide-tabs'> " + (((function() {
        var j, len, results;
        results = [];
        for (i = j = 0, len = examples.length; j < len; i = ++j) {
          page = examples[i];
          results.push("<button id='fg-tab-" + i + "' name='readymade-field-guide-tab'>" + page.label + "</button>");
        }
        return results;
      })()).join('\n')) + " </div> <div class='readymade-field-guide-pages'> " + (((function() {
        var j, len, ref, results;
        results = [];
        for (i = j = 0, len = examples.length; j < len; i = ++j) {
          page = examples[i];
          results.push("<div class='readymade-field-guide-page'> <div class='readymade-field-guide-content'>" + ((ref = page.content) != null ? ref : '') + "</div> <div class='readymade-field-guide-examples'> " + (((function() {
            var k, len1, ref1, results1;
            ref1 = page.figures;
            results1 = [];
            for (k = 0, len1 = ref1.length; k < len1; k++) {
              figure = ref1[k];
              results1.push("<div class='readymade-field-guide-example'> <img src='" + figure.image + "' alt='" + figure.alt + "' class='readymade-field-guide-image' /> <div class='readymade-field-guide-caption'>" + figure.label + "</div> </div>");
            }
            return results1;
          })()).join('\n')) + " </div> </div>");
        }
        return results;
      })()).join('\n')) + " </div>";
    };

    function FieldGuide(config) {
      this.goTo = bind(this.goTo, this);
      this.handleTabClick = bind(this.handleTabClick, this);
      var key, renderedHTML, value;
      for (key in config) {
        value = config[key];
        this[key] = value;
      }
      if (this.examples == null) {
        this.examples = [];
      }
      if (this.el == null) {
        this.el = document.createElement('div');
      }
      this.el = $(this.el);
      this.el.addClass('readymade-field-guide');
      renderedHTML = this.template(this.examples);
      this.el.append(renderedHTML);
      this.tabs = new TabSet;
      this.el.find('.readymade-field-guide-page').each((function(_this) {
        return function(i, panel) {
          var tab;
          tab = _this.el.find("#fg-tab-" + i);
          return _this.tabs.add(tab, panel, i === 0);
        };
      })(this));
      this.el.on('focus', 'button[role=tab]', this.handleTabClick);
      this.goTo(0);
    }

    FieldGuide.prototype.handleTabClick = function(e) {
      var index;
      index = e.target.id.replace('fg-tab-', '');
      return this.goTo(index);
    };

    FieldGuide.prototype.goTo = function(index) {
      return this.tabs.goTo(parseInt(index));
    };

    FieldGuide.prototype.destroy = function() {
      this.el.off('focus', 'button[role=tab]', this.handleTabClick);
      return this.tabs.destroy();
    };

    return FieldGuide;

  })();

  module.exports = FieldGuide;

}).call(this);
